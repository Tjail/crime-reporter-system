{% extends 'landing/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card border-danger shadow">
                <div class="card-header bg-danger text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-map-marker-alt"></i> Location Alert Details
                    </h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <strong>Alert Type:</strong> {{ pin.get_report_type_display }}
                        {% if hotzone %}
                            <span class="badge bg-danger float-end">
                                {{ hotzone.get_alert_level_display }}
                            </span>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <h5>Incident Details</h5>
                        <p class="text-muted">
                            <i class="fas fa-user-secret"></i> Reported by: <strong>Anonymous User</strong><br>
                            <i class="fas fa-calendar"></i> Date: {{ pin.created_at|date:"Y-m-d H:i" }}<br>
                            <i class="fas fa-users"></i> Nearby reports in last 30 days: <strong>{{ nearby_count }}</strong>
                        </p>
                        
                        {% if pin.message %}
                        <div class="alert alert-light">
                            <strong>Description:</strong><br>
                            {{ pin.message }}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <h5>Location Map</h5>
                        <div id="pinMap" style="height: 400px; border-radius: 8px;"></div>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6><i class="fas fa-shield-alt"></i> Safety Tips</h6>
                        <ul class="mb-0">
                            <li>Stay alert in this area</li>
                            <li>Avoid walking alone at night</li>
                            <li>Keep valuables hidden</li>
                            <li>Report any suspicious activity</li>
                        </ul>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'pin_detail' pin.id %}" class="btn btn-outline-primary">
                            <i class="fas fa-map"></i> View Full Map
                        </a>
                        <a href="{% url 'post_list' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Feed
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const map = L.map('pinMap').setView([{{ map_lat }}, {{ map_lng }}], 14);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);
    
    L.marker([{{ map_lat }}, {{ map_lng }}])
        .addTo(map)
        .bindPopup("<b>{{ pin.get_report_type_display }}</b><br>Reported: {{ pin.created_at|date:'Y-m-d' }}")
        .openPopup();
    
    L.circle([{{ map_lat }}, {{ map_lng }}], {
        color: 'red',
        fillColor: '#f03',
        fillOpacity: 0.1,
        radius: 1500
    }).addTo(map);
    
    {% if hotzone %}
    L.circle([{{ hotzone.latitude }}, {{ hotzone.longitude }}], {
        color: 'orange',
        fillColor: 'orange',
        fillOpacity: 0.2,
        radius: {{ hotzone.radius }} * 1000
    }).addTo(map);
    {% endif %}
});
</script>
{% endblock %}